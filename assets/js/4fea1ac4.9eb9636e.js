"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[73],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>d});var a=n(7294);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n,a,l={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var s=a.createContext({}),u=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},c=function(e){var t=u(e.components);return a.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,l=e.mdxType,i=e.originalType,s=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),m=u(n),d=l,h=m["".concat(s,".").concat(d)]||m[d]||p[d]||i;return n?a.createElement(h,r(r({ref:t},c),{},{components:n})):a.createElement(h,r({ref:t},c))}));function d(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var i=n.length,r=new Array(i);r[0]=m;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:l,r[1]=o;for(var u=2;u<i;u++)r[u]=n[u];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},5162:(e,t,n)=>{n.d(t,{Z:()=>r});var a=n(7294),l=n(6010);const i="tabItem_Ymn6";function r(e){let{children:t,hidden:n,className:r}=e;return a.createElement("div",{role:"tabpanel",className:(0,l.Z)(i,r),hidden:n},t)}},5488:(e,t,n)=>{n.d(t,{Z:()=>d});var a=n(7462),l=n(7294),i=n(6010),r=n(2389),o=n(7392),s=n(7094),u=n(2466);const c="tabList__CuJ",p="tabItem_LNqP";function m(e){var t;const{lazy:n,block:r,defaultValue:m,values:d,groupId:h,className:g}=e,b=l.Children.map(e.children,(e=>{if((0,l.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),f=d??b.map((e=>{let{props:{value:t,label:n,attributes:a}}=e;return{value:t,label:n,attributes:a}})),k=(0,o.l)(f,((e,t)=>e.value===t.value));if(k.length>0)throw new Error(`Docusaurus error: Duplicate values "${k.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);const y=null===m?m:m??(null==(t=b.find((e=>e.props.default)))?void 0:t.props.value)??b[0].props.value;if(null!==y&&!f.some((e=>e.value===y)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${y}" but none of its children has the corresponding value. Available values are: ${f.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:v,setTabGroupChoices:O}=(0,s.U)(),[w,N]=(0,l.useState)(y),T=[],{blockElementScrollPositionUntilNextRender:P}=(0,u.o5)();if(null!=h){const e=v[h];null!=e&&e!==w&&f.some((t=>t.value===e))&&N(e)}const E=e=>{const t=e.currentTarget,n=T.indexOf(t),a=f[n].value;a!==w&&(P(t),N(a),null!=h&&O(h,String(a)))},j=e=>{var t;let n=null;switch(e.key){case"ArrowRight":{const t=T.indexOf(e.currentTarget)+1;n=T[t]??T[0];break}case"ArrowLeft":{const t=T.indexOf(e.currentTarget)-1;n=T[t]??T[T.length-1];break}}null==(t=n)||t.focus()};return l.createElement("div",{className:(0,i.Z)("tabs-container",c)},l.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":r},g)},f.map((e=>{let{value:t,label:n,attributes:r}=e;return l.createElement("li",(0,a.Z)({role:"tab",tabIndex:w===t?0:-1,"aria-selected":w===t,key:t,ref:e=>T.push(e),onKeyDown:j,onFocus:E,onClick:E},r,{className:(0,i.Z)("tabs__item",p,null==r?void 0:r.className,{"tabs__item--active":w===t})}),n??t)}))),n?(0,l.cloneElement)(b.filter((e=>e.props.value===w))[0],{className:"margin-top--md"}):l.createElement("div",{className:"margin-top--md"},b.map(((e,t)=>(0,l.cloneElement)(e,{key:t,hidden:e.props.value!==w})))))}function d(e){const t=(0,r.Z)();return l.createElement(m,(0,a.Z)({key:String(t)},e))}},9087:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>d,frontMatter:()=>o,metadata:()=>u,toc:()=>p});var a=n(7462),l=(n(7294),n(3905)),i=n(5488),r=n(5162);const o={title:"Uninstall Opni",slug:"/installation/uninstall"},s=void 0,u={unversionedId:"installation/uninstall",id:"installation/uninstall",title:"Uninstall Opni",description:"Before uninstalling all capabilities should be removed from all clusters.  This can be done by clicking an installed capability in the clusters screen and choosing to remove the capability.",source:"@site/docs/installation/uninstall.md",sourceDirName:"installation",slug:"/installation/uninstall",permalink:"/installation/uninstall",draft:!1,editUrl:"https://github.com/rancher/opni-docs/edit/main/docs/installation/uninstall.md",tags:[],version:"current",frontMatter:{title:"Uninstall Opni",slug:"/installation/uninstall"},sidebar:"tutorialSidebar",previous:{title:"Enable capabilities in downstream agents",permalink:"/installation/opni_agent/capabilities"},next:{title:"Quick Start using Rancher Desktop",permalink:"/guides/rancher-desktop/"}},c={},p=[{value:"Uninstall the Opni agents",id:"uninstall-the-opni-agents",level:3},{value:"Destroying Pulumi-managed resources",id:"destroying-pulumi-managed-resources",level:3},{value:"Deleting the Pulumi stack",id:"deleting-the-pulumi-stack",level:3},{value:"Recovering configuration",id:"recovering-configuration",level:3}],m={toc:p};function d(e){let{components:t,...n}=e;return(0,l.kt)("wrapper",(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"Before uninstalling all capabilities should be removed from all clusters.  This can be done by clicking an installed capability in the clusters screen and choosing to remove the capability."),(0,l.kt)(i.Z,{mdxType:"Tabs"},(0,l.kt)(r.Z,{value:"rancher",label:"Uninstall in Rancher UI",default:!0,mdxType:"TabItem"},(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Due to the presence of a Kubernetes finalizer, the Logging backend should be disabled before Opni is uninstalled in the central cluster.  This can be done in the Opni Management UI by going to the Logging backends in the left hand navigation pane, and selecting Disable.")),(0,l.kt)("p",null,"In the Rancher UI make sure the namespace the App is installed into is selected in the top dropdown box.  Then navigate to Apps -> Installed Apps and select the installs you want to remove.  Press the ",(0,l.kt)("strong",{parentName:"p"},"Delete")," button to remove the apps."),(0,l.kt)("p",null,"If you have been using persistent storage in your cluster you should check the PersistentVolumeClaims in the cluster and clean up any Opni related PVCs as these may not be automatically cleaned up.")),(0,l.kt)(r.Z,{value:"helm",label:"Uninstall using Helm",mdxType:"TabItem"},(0,l.kt)("p",null,"To uninstall Opni using Helm, run the following command:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"helm -n opni uninstall opni\n")),(0,l.kt)("p",null,"This will uninstall all Opni components from the main cluster. "),(0,l.kt)("admonition",{type:"tip"},(0,l.kt)("p",{parentName:"admonition"},"This will not delete any persistent data stored by Cortex (e.g., in S3), or uninstall the Opni agents from downstream clusters.")),(0,l.kt)("h3",{id:"uninstall-the-opni-agents"},"Uninstall the Opni agents"),(0,l.kt)("p",null,"On each downstream cluster, run the following command to uninstall its Opni agent:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"helm -n opni-agent uninstall opni-agent\nhelm -n opni-agent uninstall opni-agent-crd # optional, delete crds\n")),(0,l.kt)("admonition",{type:"tip"},(0,l.kt)("p",{parentName:"admonition"},"Persistent volumes created by Opni workloads may still remain after uninstalling the Opni Helm charts."))),(0,l.kt)(r.Z,{value:"pulumi",label:"Uninstall using Pulumi",mdxType:"TabItem"},(0,l.kt)("h3",{id:"destroying-pulumi-managed-resources"},"Destroying Pulumi-managed resources"),(0,l.kt)("admonition",{type:"danger"},(0,l.kt)("p",{parentName:"admonition"},"Destroying Opni infrastructure provisioned with Pulumi will delete the associated S3 bucket and all data stored in it.")),(0,l.kt)("admonition",{type:"note"},(0,l.kt)("p",{parentName:"admonition"},'The instructions below can also be found in the Pulumi web console under the "Settings" tab for your stack.')),(0,l.kt)("p",null,"To delete all resources provisioned by Pulumi, run ",(0,l.kt)("inlineCode",{parentName:"p"},"pulumi destroy"),". This is an irreversible operation."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"pulumi destroy\n")),(0,l.kt)("p",null,"or by using the fully-qualified stack name:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"pulumi destroy -s org-name/project-name/stack-name\n")),(0,l.kt)("h3",{id:"deleting-the-pulumi-stack"},"Deleting the Pulumi stack"),(0,l.kt)("p",null,"To delete the stack (and its associated configuration and history) from the Pulumi console, run ",(0,l.kt)("inlineCode",{parentName:"p"},"pulumi stack rm"),":"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"pulumi stack rm org-name/project-name/stack-name\n")),(0,l.kt)("p",null,"To delete the stack but keep all provisioned cloud resources, use the ",(0,l.kt)("inlineCode",{parentName:"p"},"--force")," flag:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"pulumi stack rm --force org-name/project-name/stack-name\n")),(0,l.kt)("h3",{id:"recovering-configuration"},"Recovering configuration"),(0,l.kt)("p",null,"If you lost the ",(0,l.kt)("inlineCode",{parentName:"p"},"Pulumi.yaml")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"Pulumi.stack-name.yaml")," config files for your stack, you can recreate them as follows:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'echo "name: stack-name" > Pulumi.yaml\necho "runtime: go" >> Pulumi.yaml\n\npulumi stack select org-name/project-name/stack-name\npulumi config refresh\n')))))}d.isMDXComponent=!0}}]);